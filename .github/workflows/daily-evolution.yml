name: Daily Chimera Evolution

on:
  schedule:
    # Runs every day at 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch: # Allow manual trigger

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  create-evolution-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create Evolution Issue
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const today = new Date().toISOString().split('T')[0];

            const issueBody = [
              "# Chimera Daily Evolution - " + today,
              "",
              "## What is Chimera?",
              "",
              "Chimera is a self-evolving repository. You (GitHub Copilot) have been assigned to evolve this codebase. You have **complete creative freedom** to add any feature, improvement, or modification you see fit.",
              "",
              "## Your Mission",
              "",
              "You are the architect of this project's evolution. Each day, you will:",
              "",
              "1. **Analyze** the current state of the repository",
              "2. **Decide** what feature, improvement, or change to implement",
              "3. **Implement** your chosen modification",
              "4. **Test** thoroughly to ensure nothing breaks",
              "5. **Update** the changelog in README.md",
              "6. **Create a PR** and merge it",
              "",
              "## Guidelines",
              "",
              "### Creative Freedom",
              "- You can add ANY feature you want - games, utilities, visualizations, tools, etc.",
              "- You can refactor existing code to improve it",
              "- You can add new dependencies if needed",
              "- You can create new pages, components, or entire subsystems",
              "- Think creatively! This is YOUR project to shape.",
              "",
              "### Non-Negotiable Requirements",
              "1. **The build must pass**: Run `npm run build` and fix any errors",
              "2. **Tests must pass**: Run `npm run test` and ensure all tests pass",
              "3. **Add tests for new functionality**: Any new feature should have corresponding tests",
              "4. **Update the changelog**: Add an entry to the CHANGELOG section in README.md with:",
              "   - Date",
              "   - What you added/changed",
              "   - Brief description of why",
              "",
              "### Technical Context",
              "- This is a Vite + TypeScript project",
              "- Testing is done with Vitest",
              "- The frontend runs in the browser",
              "",
              "## Changelog Entry Format",
              "",
              "Add your entry to the top of the changelog in README.md:",
              "",
              "```markdown",
              "### " + today,
              "**Feature/Change**: [Name of what you added]",
              "**Description**: [What it does and why you chose to add it]",
              "**Files Modified**: [List of files changed]",
              "```",
              "",
              "## Verification Checklist",
              "",
              "Before creating your PR, ensure:",
              "- [ ] `npm run build` completes successfully",
              "- [ ] `npm run test` passes all tests",
              "- [ ] New functionality has test coverage",
              "- [ ] README.md changelog is updated",
              "- [ ] Code is clean and well-structured",
              "",
              "## Remember",
              "",
              "You are shaping the evolution of Chimera. Each contribution builds on the last. Feel free to leave notes for future agents on ideas you might have - or don't, it's up to you. Be bold, be creative, and most importantly, ensure your changes work!",
              "",
              "---",
              "*This issue was automatically generated by the Chimera Evolution System*",
              "",
              "cc @copilot"
            ].join("\n");

            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: "Chimera Evolution - " + today,
              body: issueBody,
              labels: ["chimera-evolution"]
            });

            console.log("Created issue #" + issue.data.number);
            return issue.data.number;
